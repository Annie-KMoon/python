<div class="my-5">
    <h1 class="text-center mb-5">반려동물 뉴스 검색</h1>
    <div class="row">
        <div class="col-12 col-md-6 col-lg-4">
            <form name="frm">
                <div class="input-group">
                    <input name="query" class="form-control" value="반려견">
                    <button class="btn btn-secondary">검색</button>
                </div>
            </form>
        </div>

        <div id="news" class="my-3"></div>
        <div id="buttons" class="text-center">
            <button id="prev" class="btn btn-secondary btn-sm px-3">이전</button>
            <span id="page" class="px-3">1/10</span>
            <button id="next" class="btn btn-secondary btn-sm px-3">다음</button>
        </div>
        {%raw%}
        <script id="temp" type="text/x-handlebars-template">
                {{#each items}}
                    <div class="mb-3">
                        <div class="text-end">
                            <button class="btn btn-danger btn-sm" text="{{description}}">감성분석</button>
                        </div>
                        
                        <h5><a href="{{link}}">{{title}}</a></h5>
                        <div class="description text-truncate">
                            {{{description}}}
                            
                        </div>
                    </div>
                    <hr>
                {{/each}}
        </script>
        {%endraw%}
    </div>
</div>
</div>

<script>

    let page = 1;
    $("#next").on("click", function () {
        page++;
        getNews();
    })

    $("#prev").on("click", function () {
        page--;
        getNews();
    })


    $("#buttons").hide();


    $("#news").on("click", ".btn-danger", function () {
        $.ajax({
            type: 'get',
            url: '/predict',
            data: { 'text': $(this).attr("text") },
            success: function (data) {
                showBox(`이 기사는 <span class="red">${data}</span>적 기사입니다.`);
            }
        });
    });

    $("#news").on("click", ".description", function () {
        $(this).toggleClass("text-truncate");
    });

    $(frm).on("submit", function (e) {
        e.preventDefault();
        const query = $(frm.query).val();
        if (query == "") {
            showBox("검색어를 입력하세요!");
            return;
        }
        getNews();
    });

    function getNews() {
        const query = $(frm.query).val();
        $.ajax({
            type: 'get',
            url: '/search',
            data: { query, page },
            success: function (data) {
                const total = data.total
                if (total == 0) {
                    showBox("검색 내용이 없습니다.");
                    $(frm.query).val("");
                    return;
                } else if (total > 5) {
                    $("#buttons").show();
                }
                // console.log(data);
                const temp = Handlebars.compile($("#temp").html());
                $("#news").html(temp(data));
                $("#page").html(page);
            }
        });
    }
</script>